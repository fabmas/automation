- defaultTab: nodes
  description: "Installa SQL Server (unattended) via Ansible."
  executionEnabled: true
  loglevel: INFO
  name: "06 - Install SQL Server (Ansible)"
  nodeFilterEditable: false
  scheduleEnabled: false
  sequence:
    commands:
      - script: |-
          #!/usr/bin/env bash
          set -euo pipefail
          export REPO_DIR="@option.repo_dir@"
          export ANSIBLE_WORKDIR="@option.ansible_workdir@"
          export ANSIBLE_INVENTORY="@option.ansible_inventory@"
          export AZ_SUBSCRIPTION_ID="@option.az_subscription_id@"
          export KEYVAULT_NAME="@option.keyvault_name@"
          export LOCALADMIN_SECRET_NAME="@option.localadmin_secret_name@"
          export STORAGE_ACCOUNT="@option.storage_account@"
          export ISO_CONTAINER="@option.iso_container@"
          export ISO_BLOB="@option.iso_blob@"

          bash "@option.repo_dir@/autodeploy/rundeck/scripts/job6_install_sql.sh"
    keepgoing: false
    strategy: node-first
  options:
    - name: repo_dir
      label: Repo directory
      required: true
      value: /opt/automation
    - name: ansible_workdir
      label: Ansible workdir
      required: true
      value: /opt/automation/autodeploy/ansible
    - name: ansible_inventory
      label: Inventory path
      required: true
      value: /opt/automation/autodeploy/ansible/inventory/terraform.yml
    - name: az_subscription_id
      label: Subscription ID
      required: true
      value: 9af59c0f-7661-48ec-ac0d-fc61688f01ea
    - name: keyvault_name
      label: Key Vault name
      required: true
      value: fabmas-kv1
    - name: localadmin_secret_name
      label: Local admin secret name
      required: true
      value: winproto01-localadmin
    - name: storage_account
      label: Storage Account name
      required: true
      value: fabmastorageaccount01
    - name: iso_container
      label: Blob container
      required: true
      value: software
    - name: iso_blob
      label: ISO blob name
      required: true
      value: SQLServer2025-x64-ENU.iso
